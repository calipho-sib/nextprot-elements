<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../neon-animation/animations/scale-down-animation.html">
<link rel="import" href="../neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../neon-animation/animations/slide-from-left-animation.html">
<link rel="import" href="../neon-animation/animations/slide-left-animation.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../paper-spinner/paper-spinner-lite.html">
<link rel="import" href="external-scripts.html">
<link rel="import" href="nextprot-elements-shared-styles.html">

<!--
`term-overview-section`
Term overview section

##### Example
    <term-overview-section nx-config='{"term": "TS-0079"}'></term-overview-section>
@demo demo/term-overview-section-demo.html
-->

<dom-module id="term-overview-section" is="dom-if" if="[[accessionName]]">

    <template>
        <style include="nextprot-elements-shared-styles">
            :host {
                display: block;
            }

            iron-collapse {
                --iron-collapse-transition-duration: 500ms;
            }

            h3 {
                text-align: left;
            }

            dd {<
                margin-left: 15px;
            }

            dt {
                font-weight: inherit;
            }

            .term-link {
                display: inline;
            }

            .paragraph {
                margin: 10px;
            }

            .ec-link {
                display: inline;
            }

            #extender {
                float: right;
                padding: 1px 6px 1px 0px;
                margin-top: -5px;
            }
        </style>
        <div id="termOverview">
            <h3>
                <template is="dom-if" if="[[term.name]]">
                    [[term.accession]] → [[term.name]]
                </template>
                [[data.entryName]]
                <template is="dom-if" if="[[data.recommendedProteinName]]">
                    <template is="dom-if" if="[[data.recommendedProteinName.EC.0]]">
                        [
                        <template is="dom-repeat" items="[[data.recommendedProteinName.EC]]" as="ec">
                            <div class="ec-link"><a href="[[nxUrl]]/term/[[ec]]">EC [[ec]]</a></div>
                            <template is="dom-if" if="[[!_checkIfLast(data.recommendedProteinName.EC,index)]]">,
                            </template>
                        </template>
                        ]
                    </template>
                    <template is="dom-if" if="[[data.recommendedProteinName.mainShortName]]">
                        ([[data.recommendedProteinName.mainShortName]])
                    </template>
                </template>
                <paper-spinner-lite id="spinner" active></paper-spinner-lite>
            </h3>
        </div>
        <div id="collapseInfosLess">
            <div id="term-info">
                <template is="dom-if" if="[[term.name]]">
                    <div id="term-ontology" class="row">
                        <div class="col-md-3 col-xs-3 grey-x text-align-right">ONTOLOGY :</div>
                        <div class="col-md-9 col-xs-9"> [[term.ontologyAltname]] <span style="color: red"> (wrong name)</span> → [[term.accession]] </div>
                    </div>
                </template>
                <template is="dom-if" if="[[term.description]]">
                    <div id="term-definition" class="row">
                        <div class="col-md-3 col-xs-3 grey-x text-align-right">DEFINITION :</div>
                        <div class="col-md-9 col-xs-9"> [[term.description]]  </div>
                    </div>
                </template>
                <template is="dom-if" if="[[term.synonyms]]">
                    <template is="dom-if" if="[[term.synonyms.0]]">
                        <div id="term-synonyms" class="row">
                            <div class="col-md-3 col-xs-3 grey-x text-align-right">SYNONYMS :</div>
                            <div class="col-md-9 col-xs-9">
                                <dl>
                                    <template is="dom-repeat" items="[[term.synonyms]]" as="synonym" sort="_sort">
                                        <dt>[[synonym]]</dt>
                                    </template>
                                </dl>
                            </div>
                        </div>
                    </template>
                </template>
                <template is="dom-if" if="[[term.synonyms]]">
                    <template is="dom-if" if="[[term.synonyms.0]]">
                        <div id="related-terms" class="row">
                            <div class="col-md-3 col-xs-3 grey-x text-align-right">RELATED TERMS :</div>
                            <div class="col-md-9 col-xs-9">
                                <span style="color:red"> What is the difference with External References, which one too choose?</span>
                            </div>
                        </div>
                    </template>
                </template>
                <template is="dom-if" if="[[term.synonyms]]">
                    <template is="dom-if" if="[[term.synonyms.0]]">
                        <div id="external-references" class="row">
                            <div class="col-md-3 col-xs-3 grey-x text-align-right">EXTERNAL REFERENCES :</div>
                            <div class="col-md-9 col-xs-9">
                                <dl>
                                    <template is="dom-repeat" items="[[term.xrefs]]" as="xref">
                                        <dt>[[xref.databaseName]]: <a href="[[xref.linkUrl]]">[[xref.accession]]</a></dt>
                                    </template>
                                </dl>
                            </div>
                        </div>
                    </template>
                </template>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'term-overview-section',
            properties: {
                nxConfig: {
                    type: Object,
                    value: {}
                },
                term: {
                    type: Object,
                    value: {}
                }

            },

            ready: function () {
                this._initApiClient();
                var self = this;
                // fetch data from overview
                this._npClient.getTermByAccession(self.nxConfig.termAccession).then(function (term) {

                    console.log(JSON.stringify(term));

                    self.term = term["cvTerm"];
                    // load data
                    //self._loadData(overview);
                    self.$.spinner.active = false;

                }, function (error) {
                    self._handleError(error);
                });

            },
            _initApiClient: function () {
                this._npClient = new Nextprot.Client("neXtOrit term overview", "Calipho Group");
                if (this.nxConfig.env) {
                    this._npClient.updateEnvironment(this.nxConfig.env);
                }

            },
            _sort: function (a, b) {
                return a < b ? -1 : 1;
            }
        })
    </script>
</dom-module>

<!--
{
  "cvTerm": {
    "id": 38286,
    "accession": "TS-0079",
    "name": "Blood",
    "description": "The body fluid that circulates in the cardiovascular system (blood vessels and blood capillaries) including plasma and blood cells.",
    "ontology": "NextprotAnatomyCv",
    "ontologyAltname": "NextProt tissues",
    "childAccession": [
      "TS-0771",
      "TS-0800"
    ],
    "xrefs": [
      {
        "dbXrefId": 3145881,
        "accession": "BTO:0000553",
        "databaseName": "BRENDA",
        "databaseCategory": "Enzyme and pathway databases",
        "url": "http://www.brenda-enzymes.org",
        "linkUrl": "http://www.brenda-enzymes.org/enzyme.php?ecno=%s&UniProtAcc=%u",
        "resolvedUrl": "http://purl.obolibrary.org/obo/BTO_0000553",
        "properties": [

        ]
      },
      {
        "dbXrefId": 3145512,
        "accession": "BTO:0000089",
        "databaseName": "BRENDA",
        "databaseCategory": "Enzyme and pathway databases",
        "url": "http://www.brenda-enzymes.org",
        "linkUrl": "http://www.brenda-enzymes.org/enzyme.php?ecno=%s&UniProtAcc=%u",
        "resolvedUrl": "http://purl.obolibrary.org/obo/BTO_0000089",
        "properties": [

        ]
      },
      {
        "dbXrefId": 28088013,
        "accession": "UBERON:0000178",
        "databaseName": "Uberon",
        "databaseCategory": "Ontologies",
        "url": "http://uberon.org",
        "linkUrl": "http://purl.obolibrary.org/obo/%s",
        "resolvedUrl": "http://purl.obolibrary.org/obo/UBERON_0000178",
        "properties": [

        ]
      },
      {
        "dbXrefId": 7198024,
        "accession": "D001769",
        "databaseName": "MeSH",
        "databaseCategory": "Ontologies",
        "url": "http://www.nlm.nih.gov/mesh/MBrowser.html",
        "linkUrl": "http://www.nlm.nih.gov/cgi/mesh/2013/MB_cgi?field=uid&term=%s",
        "resolvedUrl": "http://www.nlm.nih.gov/cgi/mesh/2013/MB_cgi?field=uid&term=D001769",
        "properties": [

        ]
      }
    ],
    "synonyms": [
      "Circulating blood ",
      " Peripheral blood ",
      " Bloodstream"
    ],
    "properties": null,
    "ancestorAccession": [
      "TS-0449",
      "TS-1297",
      "TS-2101"
    ],
    "sameAs": [
      "UBERON:0000178",
      "D001769"
    ]
  }
}
-->
