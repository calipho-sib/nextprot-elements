<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="nextprot-elements-shared-styles.html">
<link rel="import" href="external-scripts.html">

<dom-module id="heatmap-table-row">

    <style include="nextprot-elements-shared-styles">
         :host {
            display: block;
        }

        #grad {
            background: red;
            /* For browsers that do not support gradients */
            background: -webkit-linear-gradient(left top, red, yellow);
            /* For Safari 5.1 to 6.0 */
            background: -o-linear-gradient(bottom right, red, yellow);
            /* For Opera 11.1 to 12.0 */
            background: -moz-linear-gradient(bottom right, red, yellow);
            /* For Firefox 3.6 to 15 */
            background: linear-gradient(to bottom right, red, yellow);
            /* Standard syntax */
        }

        #heatmap-body {
            margin-left: auto;
            margin-right: auto;
        }

        .heatmap-tree {
            display: none;
        }

        .heatmap-row {
            border-bottom: solid 1px #d4d4d4;
            overflow: hidden;
            height: 25px;
        }

        .heatmap-row:hover {
            background-color: aliceblue;
        }

        .heatmap-rowLabel {
            display: inline-block;
            margin-bottom: 0px;
            word-break: break-all;
            cursor: pointer;
        }

        .heatmap-no-cursor {
            cursor: auto !important;
        }

        .heatmap-rowLabel a {
            margin-left: 5px;
            font-size: 12px;
        }

        .heatmap-rowLabel .glyphicon {
            margin-right: 5px;
            font-size: 12px;
        }

        .heatmap-column {
            float: left;
            height: 20px;
            width: 20px;
            text-align: center;
            margin-left: 10px;
        }

        .heatmap-group {
            display: inline-block;
            text-align: center;
            margin-right: 5px;
            margin-left: 5px;
        }

        .heatmap-circle {
            text-align: center;
            display: inline-block;
            width: 10px;
            height: 10px;
            margin-top: 5px;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
        }

        ul {
            padding-left: 10px;
            list-style-type: none;
        }

        .heatmap-inline {
            display: inline-block;
        }

        .heatmap-zoom:hover {
            cursor: pointer;
        }
        /* sandbox */

        .heatmap-info {
            display: none;
            text-align: center;
        }

        .glyphicon-refresh-animate {
            -animation: spin .7s infinite linear;
            -webkit-animation: spin2 .7s infinite linear;
        }

        .openHmChildren {
            display: block;
        }

        .heatmap-row * {
            cursor: pointer !important;
        }

        .heatmap-hidden-circle {
            display: none;
        }

        /*
        //TODO
        :host ul:nth-child(2) {
            display: block;
        }*/

        .heatmap-square {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: solid;
            border-width: 1px;
        }

        .heatmap-circle-size {
            width: 12px;
            font-size: 14px;
        }
    </style>
    <template>
        <template is="dom-repeat" items="[[data]]" as="d">
            <li>
                <div class="heatmap-row" on-tap="toggleChildren">
                    <template is="dom-if" if="[[hasChildren(d)]]">
                        <i class="fa fa-caret-right"></i>
                    </template>
                    <p class="heatmap-no-cursor heatmap-rowLabel tree-toggler">
                        <span class="rowLabel">[[d.rowLabel]]</span>
                        <span><a href="[[d.linkURL]]" target="_blank">[[d.linkLabel]]</a></span>
                    </p>
                    <div class="pull-right" style="margin-left: 25px">
                        <template is="dom-repeat" items="[[options.values]]" as="method">
                            <div style="display: inline-block; margin-right: 30px">
                                <template is="dom-repeat" items="[[method.possibleValues]]" as="possibleValue">
                                    <div class="heatmap-column heatmap-circle-size">
                                        <span class="heatmap-square" style$="{{_computeStyle(d, possibleValue, index)}}">
                                            <a href="#">[[_showEvidencesNumber(d, index)]]</a>
                                        </span>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>
                <template is="dom-if" if="[[hasChildren(d)]]">
                    <ul class="tree heatmap-opened heatmap-tree">
                        <div class="heatmap-detail">
                            <template is="dom-repeat" items="[[d.values]]" as="v">
                                <template is="dom-repeat" items="[[v.evidences]]" as="e">
                                    <div>
                                        <evidence-item data=[[e]]></evidence-item>
                                    </div>
                                </template>
                            </template>
                        </div>
                        <heatmap-table-row data="[[d.children]]" options="[[options]]"></heatmap-table-row>
                    </ul>
                </template>
            </li>
        </template>
    </template>

    <script>
        Polymer({
            is: 'heatmap-table-row',
            properties: {
                data: {
                    type: Array,
                    value: [],
                    observer: "_reload"
                },
                options: {
                    type: Object,
                    value: {}
                }
            },
            ready: function () {
                //console.log(this.options);
            },
            /*_showEvidencesNumber: function (evidences) {
                if (evidences && evidences.length > 0)
                    return evidences.length;
                else return "";
            },*/
            _showSomething: function (value, evidence) {
                console.log(value);
                return evidence.evidenceCodeName;

            },
            _showEvidencesNumber : function (data, idx) {
                if(data.values.length > 0) {
                    var evidences = data.values[idx].evidences;
                    if (evidences && evidences.length > 0)
                        return evidences.length;
                    else return "";

                } return ""
            },
            _computeStyle: function (data, possibleValue, idx) {

                if(data.values.length > 0) {
                    var value = data.values[idx].value;
                    if(value.length > 0){
                        return "background-color: " + possibleValue.color;
                    }
                }

               return "display: none";

            },
            hasChildren: function (d) {
                var boolean = d.children && d.children.length;
                return boolean;
            },
            toggleChildren: function (e) {
                var liParent = e.srcElement.closest("li")

                var icon = liParent.getElementsByTagName("i")[0]

                var children = liParent.getElementsByTagName("ul")[0]
                if(children && children.classList){
                    children.classList.toggle("openHmChildren");
                }
    
                if (icon.classList.contains("fa-caret-down")) {
                    icon.classList.remove("fa-caret-down")
                    icon.classList.add("fa-caret-right")
                } else {
                    icon.classList.remove("fa-caret-right")
                    icon.classList.add("fa-caret-down")
                }


            },
            _reload: function () {

                //console.log(this.data)

            }
        });
    </script>
</dom-module>