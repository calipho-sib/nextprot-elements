<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="term-overview-section.html">
<link rel="import" href="graph-section.html">
<link rel="import" href="nextprot-elements-shared-styles.html">
<link rel="import" href="term-overview-section.html">

<!--
`atomic-formula-item-demo`
@demo demo/atomic-formula-item-demo.html
-->
<dom-module id="atomic-formula-item">
    <template>
        <style include="nextprot-elements-shared-styles">
            .atomic-number {
                vertical-align: sub;
                font-size: smaller;
                margin-left: -3px;
            }
            .atomic-letter {
                margin-left: -1px;
            }

        </style>
        <template class="formula-container" is="dom-repeat" items="[[resultElements]]" as="re">
            <template is="dom-if" if="[[re.isNumber]]">
                    <span class="atomic-number">[[re.label]]</span>
            </template>
            <template is="dom-if" if="[[!re.isNumber]]">
                    <span class="atomic-letter">[[re.label]]</span>
            </template>
        </template>
    </template>

    <script>
        Polymer({
            is: 'atomic-formula-item',
            properties: {
                formula: {
                    type: String
                },
                resultElements: {
                    type: Array
                }
            },
            ready: function (){

                function isNum(n){
                    return ('0123456789'.indexOf(n) !== -1)
                };

                var result = [];
                var elements = this.formula.split("")
                var elements = elements.filter(function(a){return a !== '-' && a !== ' '})
                for(var i=0; i<elements.length; i++){
                    var e = elements[i];
                    var isNumber = isNum(e);
                    var isNextNumber = false;
                    if(i+1 < elements.length){
                        var ne = elements[i + 1]
                        isNextNumber = isNum(ne)
                    }
                    if(!(e == 1 && !isNextNumber)){ //Don't add in the element is one and there is no next number
                        result.push({isNumber: isNumber, label: e})
                    }
                }
                this.resultElements = result; 
            }

        }); 
    </script>
</dom-module>