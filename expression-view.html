<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="protein-overview.html">
<link rel="import" href="isoform-selector.html">
<link rel="import" href="triple-viewer.html">
<link rel="import" href="generic-annotation-section.html">
<link rel="import" href="keywords-section.html">
<link rel="import" href="xrefs-section.html">
<link rel="import" href="nextprot-elements-shared-styles.html">
<link rel="import" href="expression-section.html">

<!--
`expression-view`
View listing protein expression view.
@demo demo/expression-view-demo.html
-->
<dom-module id="expression-view">
  <template>
    <style include="nextprot-elements-shared-styles">
      :host {
        display: block;
        background:#f8f8f8;
        overflow-y: auto;
      }

      #nxOntologicalBrowser {
        padding: 10px;
      }

      .ontological-term {
        padding-left: 10px;
        margin: 1px;
        background-color: #f8f8f8;
        border-width: 1px;
        border-style: solid;
        border-color: #dddddd;
      }

    </style>
    <div class="row">
      <div id="nxOverview" class="col-md-12">
        <protein-overview nx-config="[[nxConfig]]"></protein-overview>
      </div>
    </div>
    <div id="nxGenericAnnotations" class="row nxSection">
      <generic-annotation-section id="expressionInfoElement" section="expressionInfo" gold-only="[[nxConfig.goldOnly]]" categories='["EXPRESSION-INFO", "INDUCTION", "DEVELOPMENTAL-STAGE-INFO"]' nx-config="[[nxConfig]]" count="{{genericAnnotationsCount}}"></generic-annotation-section>
    </div>


    <div id="filterPositiveNegativeSection" class="row nxSection">
      <button id="showFilterButton" class="btn btn-default pull-right" on-tap="_toggleFilters">
        <template is="dom-if" if="[[filtersShown]]">
          <iron-icon icon="arrow-drop-up"></iron-icon>
          Hide filters &nbsp;
        </template>
        <template is="dom-if" if="[[!filtersShown]]">
          <iron-icon icon="arrow-drop-down"></iron-icon>
          Show filters &nbsp;
        </template>
      </button>
      <div id="filtersContent" hidden>
        <div class="row category-row style-scope generic-annotation-section">
          <h4 class="annotation-category-title">Filter on positive / negative annotations</h4><br>
          <template is="dom-repeat" items="[[filterPositiveNegativeAnnotations]]" as="filterPN">
            <label class="radio-inline"><input type="radio" name="optradio">[[filterPN]]</label>
          </template>
        </div>
        <div class="row category-row style-scope generic-annotation-section">
          <h4 class="annotation-category-title">Filter on methodology</h4><br>
          <template is="dom-repeat" items="[[filterOnMethodology]]" as="methodology">
            <label class="checkbox-inline"><input type="checkbox" value="">[[methodology]]</label>
          </template>
        </div>
        <button id="applyFiltersButton"  class="btn btn-default pull-right" type="button">
          <i class="fa fa-filter" aria-hidden="true"></i>
          <span class="filter-submit-text">Apply filters</span>
        </button>

      </div>
    </div>

    <div id="nxOntologicalBrowser" class="row nxSection">
      <template is="dom-repeat" items="[[ontologicalBrowserTerms]]" as="term">
        <div class="col-md-3">
          <div class="ontological-term"><a href="#{{term}}">[[term]]</a></div>
        </div>
      </template>
    </div>
    <div id="nxExpressionAnnotations" class="row nxSection">
      <expression-section id="expressionSection" section="expressionSection" gold-only="[[nxConfig.goldOnly]]" nx-config="[[nxConfig]]" count="{{expressionSectionAnnotationCount}}"></expression-section>
    </div>
    <div id="noDataWarning" class='alert alert-warning noData' hidden>There is no expression information available in neXtProt for [[nxConfig.entry]].
      Suggestions for updates are welcome! Please <a href='mailto:support@nextprot.org'>contact us</a>.
    </div>
    <div class="row">
      <div id="nxXrefs" class="col-md-12">
        <xrefs-section categories='["Antibodypedia","Bgee","CleanEx","ExpressionAtlas","Genevisible","HPA"]' nx-config="[[nxConfig]]" count="{{xrefsCount}}">
        </xrefs-section>
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'expression-view',
      properties: {
        nxConfig: {
          type: Object,
          value: {}
        },
        filterOnMethodology: {
          type: Array,
          value: ["Microarray", "EST", "IHC"]
        },
        filterPositiveNegativeAnnotations: {
          type: Array,
          value: ["All", "Positive", "Negative", "Positive only", "Negative only", "Only positive or only negative", "Both positive and negative"]
        },
        ontologicalBrowserTerms: {
          type: Array,
          value: ["Alimentary system", "Cardiovascular system", "Dermal system", "Endocryne system", "Exocrine system",
                  "Hemolymphoid and immune system", "Musculoskeletal system", "Nervous system", "Reproductive system", "Respiratory system",
                  "Urinary system", "Sense organ", "Body part", "Tissue", "Cell type", "Fluid and secretion", "Gestational structure"]
        },
        expressionSectionAnnotationCount: {
          type: Number,
          value: -1,
          observer: "_checkAnnotations"
        },
        genericAnnotationsCount: {
          type: Number,
          value: -1,
          observer: "_checkAnnotations"
        },
        xrefsCount: {
          type: Number,
          observer: "_checkXrefs"
        },
        filtersShown: {
          type: Boolean,
          value: false
        }
      },
      _toggleFilters: function(){
        var self = this;
        this.async(function() {
          self.$.filtersContent.hidden = !self.$.filtersContent.hidden;
          self.filtersShown = !self.filtersShown;
        }, 1);
      },
      _toggleAllEvidences: function(){
        this.async(function() {
          this.evidencesShown=true;
          var evidenceContainers = Polymer.dom(this.root).querySelectorAll(".evidences-container");
          for (var e in evidenceContainers) {
            if (this.showEvidences == true) {
              evidenceContainers[e].parentNode.opened = true;
            } else {
              evidenceContainers[e].parentNode.opened = false;
            }
          }
          this.evidencesShown = this.showEvidences;
          this.showEvidences = !this.showEvidences;
        }, 1);
      },
      _checkAnnotations: function(){

        this.$.nxGenericAnnotations.hidden= (this.genericAnnotationsCount) ? false : true;

        this.$.nxExpressionAnnotations.hidden= (this.expressionSectionAnnotationCount) ? false : true;
        this.$.nxOntologicalBrowser.hidden= (this.expressionSectionAnnotationCount) ? false : true;


        if(this.expressionSectionAnnotationCount===0 && this.genericAnnotationsCount===0) {
          this.$.noDataWarning.hidden=false;
        }
        else this.$.noDataWarning.hidden=true;
      },
      _checkXrefs: function(){
        this.xrefsCount===0 ? this.$.nxXrefs.hidden=true : this.$.nxXrefs.hidden=false;
      }
    });
  </script>
</dom-module>