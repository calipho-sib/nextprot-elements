<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">

<link rel="import" href="exon-item.html">
<link rel="import" href="exons-mapping-table.html">

<link rel="import" href="external-scripts.html">

<link rel="import" href="protein-overview.html">

<!--
`exon-view`
Exon view demo

@demo demo/exon-view-demo.html
-->
<dom-module id="exon-view">
    <template>
        <style include="nextprot-elements-shared-styles">
            :host {
                display: block;
                overflow-y: auto;
            }
        </style>
        <div class="row">
            <div id="nxOverview" class="col-md-12">
                <protein-overview nx-config="[[nxConfig]]"></protein-overview>
            </div>
            <div>
                <exons-mapping-table data="[[data]]" exon-witdh="[[exonWidth]]"></exons-mapping-table>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'exon-view',
            properties: {
                nxConfig: {
                    type: Object,
                    value: {}
                },
                data: {
                    type: Object
                },
                exonWidth: {
                    type: Number,
                    value: 50
                }
            },
            attached: function () {

                this._initApiClient();

                var self = this;

                this._npClient.getJSON("/entry/" + this.nxConfig.entry + "/ensgs.json")
                    .then(function (response) {
                        var ensg = self._getENSG(response);

                        self._npClient.getJSON("/entry/" + self.nxConfig.entry + "/exon-mapping/"+
                            ensg+".json")
                            .then(function (response) {
                                self._handleResponseData(response);
                            })
                            .catch(function (error) {
                                self._handleError(error);
                            });
                    })
                    .catch(function (error) {
                        self._handleError(error);
                    });

            },
            _initApiClient: function () {
                this._npClient = new Nextprot.Client("neXtProt publications", "Calipho Group");

                if (this.nxConfig.env) {
                    this._npClient.updateEnvironment(this.nxConfig.env);
                }
            },
            _getENSG: function (ensgs) {
                return ensgs[0]
            },
            _handleResponseData: function (data) {
                this.data = data;
            },
            _handleError: function (error) {
                console.error("Error: ", error);
            }
        });
    </script>
</dom-module>