<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../nextprot-elements-shared-styles.html">

<dom-module id="heatmap-table-row">
    <style>
         :host {
            display: block;
        }

        .openHmChildren {
            display: block;
        }

        .heatmap-row * {
            cursor: pointer !important;
        }

        .heatmap-not-detected-circle {
            background-color: lightgray;
        }

        .heatmap-positive-circle {
            background-color: #FFA10A;
        }

        .heatmap-medium-circle {
            background-color: #ffc870;
        }

        .heatmap-medium-circle {
            background-color: #ffe6bd;
        }
        .heatmap-hidden-circle {
            display: none;
        }

        .heatmap-unkown-circle {
            background-color: black;
        }

        .heatmap-square {
            display: inline-block;
            width: 10px;
            height: 18px;
        }

        .heatmap-circle-size {
            width: 12px;
            font-size: 14px;
        }
    </style>
    <template>
        <ul>
            <template is="dom-repeat" items="[[data]]" as="d">
                <li>
                    <div class="heatmap-row" on-tap="toggleChildren">
                        <span class="glyphicon glyphicon-record"></span>
                        <p class="heatmap-no-cursor heatmap-rowLabel tree-toggler">
                            <span class="rowLabel">[[d.rowLabel]]</span>
                            <span><a href="[[d.linkURL]]" target="_blank">[[d.linkLabel]]</a></span>
                        </p>
                        <div class="pull-right">
                            <template is="dom-repeat" items="[[d.values]]" as="v">
                                <div class="heatmap-column heatmap-circle-size">
                                    <span class$="{{computeClass(d, v)}}" data-toggle="tooltip" title="" data-original-title="[[v.value]]"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                    <template is="dom-if" if="[[hasChildren(d)]]">
                        <ul class="tree heatmap-opened heatmap-tree">
                            <heatmap-table-row data="[[d.children]]"></heatmap-table-row>
                        </ul>
                    </template>
                </li>
            </template>
        </ul>
    </template>

    <script>
        Polymer({
            is: 'heatmap-table-row',
            properties: {
                data: {
                    type: Array,
                    value: [],
                    observer: "_reload"
                }
            },
            ready: function () {
                //console.log(this.data);
            },
            computeClass: function (d, v) {

                if (v.value === 'not detected' || v.value === 'negative') {
                    return "heatmap-square heatmap-not-detected-circle";
                } else if (v.value === 'positive' || v.value === 'high') {
                    return "heatmap-square heatmap-positive-circle";
                } else if (v.value === 'medium') {
                    return "heatmap-square heatmap-medium-circle";
                }

                if (v.value.length == 0) {
                    return "heatmap-square heatmap-hidden-circle";
                } else {
                    console.log("Not expecting this value here. ", v);
                    return "heatmap-square heatmap-unkown-circle";
                }

            },
            hasChildren: function (d) {
                var boolean = d.children && d.children.length;
                return boolean;
            },
            toggleChildren: function (e) {
                var liParent = e.srcElement.closest("li")
                var children = liParent.getElementsByTagName("ul")[0]
                children.classList.toggle("openHmChildren");
                children.classList.toggle("transient");
            },
            _reload: function () {

                //console.log(this.data)

            }
        });
    </script>
</dom-module>