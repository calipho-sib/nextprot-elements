<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="nextprot-elements-shared-styles.html">
<link rel="import" href="external-scripts.html">
<script src="../jquery-ui/jquery-ui.min.js"></script>
<script src="../bootstrap/js/tooltip.js"></script>
<script src="../bootstrap/js/popover.js"></script>
<script src="../handlebars/handlebars.min.js"></script>
<script src="bio-viz-v2/biovizJS/library/jquery.ui-contextmenu.min.js"></script>
<script src="bio-viz-v2/dist/bio-viz.min.js"></script>
<!--
`bioviz-v2-section`
Element joining bioviz viewer and 3D structures table

@demo demo/bioviz-v2-section-demo.html
-->
<dom-module id="bioviz-v2-section">
    <link rel="stylesheet" type="text/css" href="bio-viz-v2/css/style.css">
    <link rel="stylesheet" type="text/css" href="bio-viz-v2/dist/bio-viz.min.css">
    <link rel="stylesheet" type="text/css" href="bio-viz-v2/biovizJS/css/bioviz-theme/jquery-ui.min.css">
    <template>
        <style include="nextprot-elements-shared-styles">
            :host {
                display: block;
            }
            .ext-link:after {
                content: "\f08e";
                font-family: "FontAwesome";
                font-size: 11px;
                margin-left: 5px;
                vertical-align: middle;
            }
            h1 {
    margin: 20px auto 30px;
    text-align: center;
}

table.dataTable td {
    height: 37px;
}

.table-striped>tbody>tr:nth-of-type(odd) td {
    background-color: #f9f9f9;
}


/*Table fixed css */

table.dataTable{
    padding:5px 0px;
}

table.dataTable thead .sorting:after, table.dataTable thead .sorting_asc:after, table.dataTable thead .sorting_desc:after, table.dataTable thead .sorting_asc_disabled:after, table.dataTable thead .sorting_desc_disabled:after{
    top:0px;
}
table.dataTable th{
    white-space: nowrap;
}

.pdbTableContainer{
    border-bottom:1px solid #ccc;
    margin-bottom:5px;
}

.pdbPosException:before{
    font-size:8px;
    vertical-align: top;
}

.btn-label {
    position: relative;
    left: -4px;
    display: inline-block;
    padding: 2px 4px 2px 8px;
    background: rgba(0,0,0,0.15);
    border-radius: 3px 0 0 3px;
    color:rgba(255, 255, 255, 0.8);
    font-weight: 300;
}
.btn-labeled {
    padding-top: 0;
    padding-bottom: 0;
    padding-left:0px;
    padding-right:3px;
}
table.dataTable td, table.dataTable th{
    padding:0px 10px;
}
table.dataTable th{
    border-right:1px solid #eee;
}

table.dataTable tr td:last-child{
    white-space:nowrap;
    overflow:hidden;
}
table.dataTable tr td:last-child a:last-child{
    margin-left:3px;
}
table.dataTable td:nth-child(3),table.dataTable td:nth-child(5),
table.dataTable th:nth-child(3),table.dataTable th:nth-child(5) {
    text-align : right;
    padding-right:20px;
}
/* BioViz viewer */
body {
/*    text-align: center;*/
}

#bioviz {
    background:#333333;
    height: 580px;
    width: 100%;
    margin-bottom:20px;
}
#bioviz iframe {
    height:100%;
    width:100%;
}
#fv {
    text-align: left;
}

#pdbForm {
    margin-bottom: 15px;
}

.panel-heading h3 {
    margin: 0px;
}

#pdbForm select {
    display: inline-block;
    width: 100px;
}

#pdbForm label {
    display: inline-block;
    width: 130px;
    text-align: right;
    margin: 15px 10px 0px 0px;
}
#bioviz-container .params{
    box-shadow:none;
    border: 1px solid #cfd9db;
}
.params.panel-default>.panel-heading{
    background-color:white;
}
.params {
    text-align: left;
}

.params h4 {
    font-weight: 300;
    border-bottom: 1px solid #ccc;
    padding-bottom: 5px;
}

.clickLog li {
    text-decoration: none;
    list-style: none;
}

#eventTriggered {
    max-height: 150px;
    overflow-y: scroll;
}

.date {
    font-style: italic;
    font-size: 13px;
    width: 50px;
    display: inline-block;
}

/*
.badge {
    margin: 0px 10px;
    border-radius: 3px;
}
*/

.fv-badge {
    background-color: #1bce97;
}

.checkbox-inline {
    display: inline-block;
    vertical-align: baseline;
}

.checkbox-inline label {
    font-size: 11px;
    font-weight: 900;
}

.checkbox-inline input[type=checkbox] {
    position: relative;
    margin-right: 5px;
}

.noPdb{
    margin:10px 20px;
}
.noPdb .glyphicon{
    margin-right:10px;
    font-size:18px;
    vertical-align: middle;
    top: -1px;
}
.noPdb .alert-text{
    vertical-align: middle;
}

.params .panel-heading h4{
    display: inline-block;
    vertical-align: middle;
    font-weight: 500;
    border:none;
    padding:0px;
}
.params .panel-heading{
    padding:5px 15px;
}
.params .panel-body{
    min-height:528px;
    padding:10px 15px;
}

#structureCount{
    border-radius:70%;
    border: 2px solid black;
    color:#C50063;
    background-color:transparent;
    padding:8px 8px;
    margin-right:10px;
    vertical-align:middle;
    min-width:32px;
}

.bioviz-menu-info{
    margin-bottom:0px;
    margin-top:10px;
    padding:5px 10px;
    display:inline-block;
}
.bioviz-menu-info .fa{
    vertical-align: text-top;
    height: 17px;
    margin-right: 7px;
}
.bioviz-menu-info .fa:before{
    font-size:17px;
}
.bioviz-menu-info kbd{
    padding:2px 6px;
    margin:0px 2px;
}
        </style>
        <div id="bioviz-container"></div>
    </template>
    <script>
        Polymer({
            is: 'bioviz-v2-section',
            properties: {
                nxConfig: {
                    type: Object,
                    value: {}
                },
                nxEntry: {
                    type: String,
                    observer: "_setDefaultIsoform"
                },
                isoform: {
                    type: String,
                    observer: "_onIsoformChange"
                },
                selection: {
                    type: Object,
                    observer: "highlight"
                }
            },
            attached: function() {
                this.nx = new Nextprot.Client("neXtprot triple viewer", "Calipho Group");
                this.nxConfig.env = "dev";
                console.log("test env");
                console.log(this.nxConfig.env);
                if (this.nxConfig.env) this.nx.updateEnvironment(this.nxConfig.env);
                console.log(this.nxConfig);
                this.nxEntry = this.nx.getEntryName(this.nxConfig.entry);
                this.bv = new nxBioViz();
                console.log("going to init :");
                this.bv.init("#bioviz-container", this.isoform);
            },
            highlight: function() {
                this.bv.highlightFromRange([this.selection.start, this.selection.end]);
            },
            _setDefaultIsoform: function() {
                this.isoform = this.nxEntry+"-1";
            },
            _onIsoformChange: function() {
                if (this.$.bioviz) this.bv.reloadTable(this.isoform);
            }
        });
    </script>
</dom-module>